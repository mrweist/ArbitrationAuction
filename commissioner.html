<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arbitration Auction - Commissioner Setup</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{--espn-red:#d00;--espn-red-dark:#a00;--espn-nav-dark:#282828;--espn-blue:#0b6ebd;--espn-text-primary:#333;--espn-text-secondary:#666;--espn-text-muted:#999;--espn-bg-page:#eaeaea;--espn-bg-card:#fff;--espn-bg-table-header:#f9f9f9;--espn-border:#e0e0e0;--espn-orange:#f7a500;--espn-success:#00703c;--espn-error:#c41e3a}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Roboto',sans-serif;background:var(--espn-bg-page);color:var(--espn-text-primary);font-size:15px;line-height:1.6}
    .header{background:var(--espn-red);height:60px;display:flex;align-items:center;justify-content:space-between;padding:0 28px}
    .header-title{font-family:'Roboto Condensed',sans-serif;font-weight:700;font-size:1.6rem;color:white;text-transform:uppercase}
    .header-user{color:white;font-size:14px}
    .logout-btn{background:rgba(255,255,255,.2);color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:13px;margin-left:12px}
    .logout-btn:hover{background:rgba(255,255,255,.3)}
    .nav{background:var(--espn-nav-dark);padding:0 28px;height:50px;display:flex;align-items:center}
    .nav-item{color:white;font-size:15px;padding:14px 20px;cursor:pointer}
    .nav-item.active{border-bottom:3px solid var(--espn-red)}
    .main-content{max-width:1200px;margin:32px auto;padding:0 28px}
    .page-header{margin-bottom:32px}
    .page-title{font-family:'Roboto Condensed',sans-serif;font-size:2.2rem;font-weight:700}
    .page-subtitle{color:var(--espn-text-secondary);margin-top:8px;font-size:16px}
    .card{background:var(--espn-bg-card);border:1px solid var(--espn-border);border-radius:8px;margin-bottom:28px}
    .card-header{background:var(--espn-bg-table-header);padding:16px 24px;font-family:'Roboto Condensed',sans-serif;font-weight:700;font-size:1.15rem;text-transform:uppercase;border-bottom:1px solid var(--espn-border)}
    .card-body{padding:24px}
    .form-group{margin-bottom:20px}
    .form-group label{display:block;font-size:13px;font-weight:600;color:var(--espn-text-secondary);text-transform:uppercase;margin-bottom:8px}
    .form-group input,.form-group select,.form-group textarea{width:100%;padding:14px 16px;font-size:16px;border:1px solid var(--espn-border);border-radius:6px}
    .form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:var(--espn-blue)}
    .form-hint{font-size:13px;color:var(--espn-text-muted);margin-top:6px}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:24px}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:16px 32px;font-size:15px;font-weight:600;text-transform:uppercase;border:none;border-radius:6px;cursor:pointer;font-family:'Roboto Condensed',sans-serif}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .btn-primary{background:var(--espn-red);color:white}
    .btn-primary:hover:not(:disabled){background:var(--espn-red-dark)}
    .btn-secondary{background:var(--espn-bg-table-header);color:var(--espn-text-primary);border:1px solid var(--espn-border)}
    .btn-blue{background:var(--espn-blue);color:white}
    .btn-success{background:var(--espn-success);color:white}
    .btn-small{padding:8px 16px;font-size:13px}
    .data-table{width:100%;border-collapse:collapse;font-size:15px}
    .data-table th{background:var(--espn-bg-table-header);padding:14px 16px;text-align:left;font-weight:600;text-transform:uppercase;font-size:12px;border-bottom:2px solid var(--espn-border)}
    .data-table td{padding:14px 16px;border-bottom:1px solid var(--espn-border)}
    .data-table input{padding:10px 12px;font-size:15px;width:100%}
    .data-table input[type="number"]{width:90px;text-align:right}
    .data-table select{padding:10px 12px;font-size:15px}
    .info-box{background:#e3f2fd;border:1px solid var(--espn-blue);border-radius:8px;padding:20px;margin-bottom:20px}
    .info-box h4{color:var(--espn-blue);margin-bottom:12px;font-size:16px}
    .info-box ul{margin-left:24px}
    .info-box li{margin:10px 0;font-size:15px}
    .success-box{background:#d4edda;border:1px solid var(--espn-success);border-radius:8px;padding:20px;margin-bottom:20px}
    .success-box h4{color:var(--espn-success);margin-bottom:8px}
    .error-box{background:#f8d7da;border:1px solid var(--espn-error);border-radius:8px;padding:20px;color:var(--espn-error);margin-bottom:20px}
    .warning-box{background:#fff3cd;border:1px solid var(--espn-orange);border-radius:8px;padding:20px;margin-bottom:20px}
    .warning-box h4{color:#856404;margin-bottom:8px}
    .login-container{max-width:480px;margin:80px auto;padding:0 20px}
    .login-card{background:var(--espn-bg-card);border:1px solid var(--espn-border);border-radius:8px;padding:40px}
    .login-title{font-family:'Roboto Condensed',sans-serif;font-size:2rem;font-weight:700;text-align:center;margin-bottom:32px}
    .login-tabs{display:flex;gap:8px;margin-bottom:24px}
    .login-tab{flex:1;padding:12px;text-align:center;background:var(--espn-bg-table-header);border:none;cursor:pointer;font-weight:600;border-radius:6px}
    .login-tab.active{background:var(--espn-blue);color:white}
    .arb-badge{display:inline-block;padding:4px 12px;border-radius:4px;font-size:13px;font-weight:700;color:white}
    .arb-badge.arb-3{background:var(--espn-red)}
    .arb-badge.arb-2{background:var(--espn-orange)}
    .arb-badge.arb-1{background:var(--espn-success)}
    .detecting-badge{background:var(--espn-orange);color:white;padding:4px 8px;border-radius:4px;font-size:11px;font-weight:700;margin-left:8px}
    .detected-badge{background:var(--espn-success);color:white;padding:4px 8px;border-radius:4px;font-size:11px;font-weight:700;margin-left:8px}
    .action-buttons{display:flex;gap:12px;margin-top:24px}
    .action-buttons .btn{flex:1}
    .league-list{list-style:none}
    .league-item{background:var(--espn-bg-card);border:1px solid var(--espn-border);border-radius:8px;padding:20px;margin-bottom:16px;cursor:pointer}
    .league-item:hover{border-color:var(--espn-blue)}
    .league-item-name{font-weight:700;font-size:18px;margin-bottom:8px}
    .league-item-meta{font-size:13px;color:var(--espn-text-secondary)}
    .auction-link-box{background:var(--espn-bg-table-header);border:1px solid var(--espn-border);border-radius:6px;padding:16px;margin-top:16px}
    .auction-link-box input{width:100%;padding:12px;border:1px solid var(--espn-border);border-radius:4px;font-size:14px;font-family:monospace}
    .copy-btn{background:var(--espn-blue);color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:13px;margin-top:10px}
    .copy-btn:hover{opacity:.9}
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
  <script type="text/babel">
const {useState, useEffect, useCallback} = React;

// Firebase config - will be set by user
const FIREBASE_CONFIG = {
  apiKey: "AIzaSyC09xnc-SIXcz95O_tfVes0t_uF-AtMmwo",
  authDomain: "arbitration-auction.firebaseapp.com",
  databaseURL: "https://arbitration-auction-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "arbitration-auction",
  storageBucket: "arbitration-auction.firebasestorage.app",
  messagingSenderId: "105886135634",
  appId: "1:105886135634:web:ef411018b3017a4c23768b"
};

// Initialize Firebase
if (!firebase.apps.length) {
  firebase.initializeApp(FIREBASE_CONFIG);
}
const db = firebase.database();

// Helper functions
const genId = () => {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  return Array.from({length: 8}, () => chars[Math.floor(Math.random() * chars.length)]).join('');
};

const hashPassword = (password) => CryptoJS.SHA256(password).toString();

const DEFAULT_HIT = {'1B':1,'2B':2,'3B':3,'HR':4,'R':1,'RBI':1,'BB':1,'HBP':1,'SB':2};
const DEFAULT_PIT = {'IP':2,'ER':-1,'K':1,'H':-0.5,'BB':-0.5,'HBP':-0.5,'W':10,'SV':8,'HD':7,'CG':5};

const csvTemplate = () => 'Name,Owner,ArbYear,Team,Position,Type,Points\nJuan Soto,Team 1,3,,,Hitter,906.50\nShohei Ohtani,Team 2,2,,,Both,1640.50\nCorbin Burnes,Team 3,1,,,Pitcher,\n';

const downloadCSV = (content, filename) => {
  const blob = new Blob([content], {type: 'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);
};

// MLB API player detection
const detectPlayerInfo = async (playerName) => {
  try {
    const searchUrl = `https://statsapi.mlb.com/api/v1/people/search?names=${encodeURIComponent(playerName)}`;
    const response = await fetch(searchUrl);
    const data = await response.json();
    
    if (data.people && data.people.length > 0) {
      const player = data.people[0];
      const team = player.currentTeam?.abbreviation || '';
      const position = player.primaryPosition?.abbreviation || '';
      
      let type = 'Hitter';
      const posCode = player.primaryPosition?.code;
      if (posCode === '1') type = 'Pitcher';
      else if (position === 'TWP' || (posCode !== '1' && player.pitchHand)) type = 'Both';
      
      return {success: true, team, position, type, playerId: player.id};
    }
    return {success: false};
  } catch (error) {
    console.error('Detection error:', error);
    return {success: false};
  }
};

// Parse CSV
const parseCSV = (csvText) => {
  const lines = csvText.trim().split('\n');
  if (lines.length < 2) return [];
  
  const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
  const players = [];
  
  for (let i = 1; i < lines.length; i++) {
    const values = lines[i].split(',').map(v => v.trim());
    const player = {};
    headers.forEach((header, idx) => {
      player[header] = values[idx] || '';
    });
    if (player.name) players.push(player);
  }
  
  return players;
};

// Login Component
function LoginScreen({onLogin}) {
  const [isLogin, setIsLogin] = useState(true);
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    setLoading(true);

    try {
      if (isLogin) {
        // Login
        const snapshot = await db.ref(`admins/${username}`).once('value');
        const admin = snapshot.val();
        
        if (!admin) {
          setError('Admin account not found');
          setLoading(false);
          return;
        }
        
        if (hashPassword(password) !== admin.passwordHash) {
          setError('Incorrect password');
          setLoading(false);
          return;
        }
        
        onLogin({username, ...admin});
      } else {
        // Register
        const snapshot = await db.ref(`admins/${username}`).once('value');
        if (snapshot.exists()) {
          setError('Username already taken');
          setLoading(false);
          return;
        }
        
        const adminData = {
          username,
          passwordHash: hashPassword(password),
          createdAt: Date.now()
        };
        
        await db.ref(`admins/${username}`).set(adminData);
        onLogin({username, ...adminData});
      }
    } catch (err) {
      setError('Error: ' + err.message);
      setLoading(false);
    }
  };

  return (
    <div className="login-container">
      <div className="login-card">
        <div className="login-title">Admin Portal</div>
        
        <div className="login-tabs">
          <button className={`login-tab ${isLogin ? 'active' : ''}`} onClick={() => setIsLogin(true)}>
            Login
          </button>
          <button className={`login-tab ${!isLogin ? 'active' : ''}`} onClick={() => setIsLogin(false)}>
            Register
          </button>
        </div>

        <form onSubmit={handleSubmit}>
          <div className="form-group">
            <label>Username</label>
            <input
              type="text"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
              required
            />
          </div>

          <div className="form-group">
            <label>Password</label>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
            />
          </div>

          {error && <div className="error-box">{error}</div>}

          <button type="submit" className="btn btn-primary" style={{width: '100%'}} disabled={loading}>
            {loading ? 'Processing...' : (isLogin ? 'Login' : 'Create Account')}
          </button>
        </form>
      </div>
    </div>
  );
}

// League List Component
function LeagueList({admin, onSelectLeague, onCreateNew}) {
  const [leagues, setLeagues] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const loadLeagues = async () => {
      try {
        const snapshot = await db.ref(`admins/${admin.username}/leagues`).once('value');
        const leaguesData = snapshot.val() || {};
        
        const userLeagues = Object.entries(leaguesData)
          .map(([id, data]) => ({id, ...data, status: 'active'}));
        
        setLeagues(userLeagues);
      } catch (err) {
        console.error('Error loading leagues:', err);
      }
      setLoading(false);
    };

    loadLeagues();
  }, [admin.username]);

  if (loading) {
    return <div className="main-content">Loading...</div>;
  }

  return (
    <div className="main-content">
      <div className="page-header">
        <div className="page-title">Your Leagues</div>
        <div className="page-subtitle">Select a league to manage or create a new one</div>
      </div>

      <div className="card">
        <div className="card-body">
          <button className="btn btn-primary" onClick={onCreateNew}>
            + Create New League
          </button>
        </div>
      </div>

      {leagues.length > 0 ? (
        <ul className="league-list">
          {leagues.map(league => (
            <li key={league.id} className="league-item" onClick={() => onSelectLeague(league.id)}>
              <div className="league-item-name">{league.name}</div>
              <div className="league-item-meta">
                Created: {new Date(league.createdAt).toLocaleDateString()} • 
                Status: {league.status || 'setup'}
              </div>
            </li>
          ))}
        </ul>
      ) : (
        <div className="info-box">
          <h4>No leagues yet</h4>
          <p>Create your first league to get started!</p>
        </div>
      )}
    </div>
  );
}

// League Setup Component
function LeagueSetup({admin, leagueId, onComplete}) {
  const [step, setStep] = useState(1);
  const [leagueName, setLeagueName] = useState('');
  const [leagueCode, setLeagueCode] = useState('');
  const [commCode, setCommCode] = useState('');
  const [teams, setTeams] = useState([
    {name: 'Team 1', budget: 100, spotsAvailable: 25, isCommissioner: true},
    {name: 'Team 2', budget: 100, spotsAvailable: 25, isCommissioner: false}
  ]);
  const [players, setPlayers] = useState([]);
  const [csvText, setCsvText] = useState('');
  const [detecting, setDetecting] = useState(false);
  const [error, setError] = useState('');

  const addTeam = () => {
    setTeams([...teams, {name: `Team ${teams.length + 1}`, budget: 100, spotsAvailable: 25, isCommissioner: false}]);
  };

  const updateTeam = (idx, field, value) => {
    const newTeams = [...teams];
    newTeams[idx][field] = value;
    setTeams(newTeams);
  };

  const handleCSVUpload = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = (event) => {
      const text = event.target.result;
      setCsvText(text);
      processCSV(text);
    };
    reader.readAsText(file);
  };

  const processCSV = (text) => {
    const parsed = parseCSV(text || csvText);
    if (parsed.length === 0) {
      setError('No valid players found in CSV');
      return;
    }
    setPlayers(parsed.map(p => ({
      name: p.name || '',
      owner: p.owner || '',
      arbYear: parseInt(p.arbyear) || 1,
      team: p.team || '',
      position: p.position || '',
      type: p.type || '',
      points: parseFloat(p.points) || 0,
      needsDetection: !p.team || !p.position || !p.type
    })));
    setError('');
  };

  const detectAllPlayers = async () => {
    setDetecting(true);
    const updated = [...players];
    
    for (let i = 0; i < updated.length; i++) {
      if (updated[i].needsDetection) {
        const result = await detectPlayerInfo(updated[i].name);
        if (result.success) {
          updated[i].team = result.team;
          updated[i].position = result.position;
          updated[i].type = result.type;
          updated[i].needsDetection = false;
        }
      }
    }
    
    setPlayers(updated);
    setDetecting(false);
  };

  const saveLeague = async () => {
    try {
      const lid = leagueId || genId();
      
      // Build teams object
      const teamsObj = {};
      teams.forEach((team, idx) => {
        teamsObj[`team${idx + 1}`] = {
          name: team.name,
          budget: team.budget,
          spotsAvailable: team.spotsAvailable,
          isCommissioner: team.isCommissioner,
          currentSalary: 0,
          joined: false,
          claimedBy: null,
          ownerName: '',
          passwordHash: ''
        };
      });

      // Build players array
      const playersArr = players.map(p => ({
        name: p.name,
        team: p.team,
        position: p.position,
        owner: p.owner,
        arbYear: p.arbYear,
        type: p.type,
        fantasyPoints: p.points,
        status: 'pending'
      }));

      // Sort players by arb year (desc) then by points (desc)
      playersArr.sort((a, b) => {
        if (b.arbYear !== a.arbYear) return b.arbYear - a.arbYear;
        return b.fantasyPoints - a.fantasyPoints;
      });

      const auctionData = {
        leagueName: leagueName,
        leagueAccessCode: leagueCode,
        commissionerAccessCode: commCode,
        createdBy: admin.username,
        createdAt: Date.now(),
        phase: 'lobby',
        teams: teamsObj,
        players: playersArr,
        currentPlayerIndex: 0,
        timerDuration: 120,
        hittingScoring: DEFAULT_HIT,
        pitchingScoring: DEFAULT_PIT,
        preBids: {},
        bidHistory: []
      };

      await db.ref(`auctions/${lid}`).set(auctionData);
      
      // Also save to admin's league list
      await db.ref(`admins/${admin.username}/leagues/${lid}`).set({
        name: leagueName,
        createdAt: Date.now()
      });
      
      onComplete(lid, leagueName);
    } catch (err) {
      setError('Error saving league: ' + err.message);
    }
  };

  return (
    <div className="main-content">
      <div className="page-header">
        <div className="page-title">{leagueId ? 'Edit League' : 'Create New League'}</div>
      </div>

      {step === 1 && (
        <div className="card">
          <div className="card-header">League Information</div>
          <div className="card-body">
            <div className="form-group">
              <label>League Name</label>
              <input
                type="text"
                value={leagueName}
                onChange={(e) => setLeagueName(e.target.value)}
                placeholder="My Fantasy League"
              />
            </div>

            <div className="form-row">
              <div className="form-group">
                <label>League Access Code</label>
                <input
                  type="text"
                  value={leagueCode}
                  onChange={(e) => setLeagueCode(e.target.value)}
                  placeholder="LEAGUE2025"
                />
                <div className="form-hint">All users need this code to join</div>
              </div>

              <div className="form-group">
                <label>Commissioner Access Code</label>
                <input
                  type="text"
                  value={commCode}
                  onChange={(e) => setCommCode(e.target.value)}
                  placeholder="ADMIN2025"
                />
                <div className="form-hint">Only commissioners need this code</div>
              </div>
            </div>

            <button className="btn btn-primary" onClick={() => setStep(2)} disabled={!leagueName || !leagueCode || !commCode}>
              Continue →
            </button>
          </div>
        </div>
      )}

      {step === 2 && (
        <div className="card">
          <div className="card-header">Teams Setup</div>
          <div className="card-body">
            <table className="data-table">
              <thead>
                <tr>
                  <th>Team Name</th>
                  <th>Budget ($)</th>
                  <th>Spots Available</th>
                  <th>Commissioner?</th>
                </tr>
              </thead>
              <tbody>
                {teams.map((team, idx) => (
                  <tr key={idx}>
                    <td>
                      <input
                        type="text"
                        value={team.name}
                        onChange={(e) => updateTeam(idx, 'name', e.target.value)}
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        value={team.budget}
                        onChange={(e) => updateTeam(idx, 'budget', parseInt(e.target.value))}
                      />
                    </td>
                    <td>
                      <input
                        type="number"
                        value={team.spotsAvailable}
                        onChange={(e) => updateTeam(idx, 'spotsAvailable', parseInt(e.target.value))}
                      />
                    </td>
                    <td>
                      <input
                        type="checkbox"
                        checked={team.isCommissioner}
                        onChange={(e) => updateTeam(idx, 'isCommissioner', e.target.checked)}
                      />
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>

            <div className="action-buttons">
              <button className="btn btn-secondary" onClick={addTeam}>+ Add Team</button>
              <button className="btn btn-secondary" onClick={() => setStep(1)}>← Back</button>
              <button className="btn btn-primary" onClick={() => setStep(3)}>Continue →</button>
            </div>
          </div>
        </div>
      )}

      {step === 3 && (
        <div className="card">
          <div className="card-header">Players Setup</div>
          <div className="card-body">
            <div className="info-box">
              <h4>Upload Player List</h4>
              <ul>
                <li>Minimum required: Name, Owner, ArbYear</li>
                <li>Optional: Team, Position, Type, Points</li>
                <li>System will auto-detect missing fields using MLB API</li>
              </ul>
              <button className="btn btn-small btn-blue" onClick={() => downloadCSV(csvTemplate(), 'players_template.csv')}>
                Download Template
              </button>
            </div>

            <div className="form-group">
              <label>Upload CSV File</label>
              <input type="file" accept=".csv" onChange={handleCSVUpload} />
            </div>

            <div className="form-group">
              <label>Or Paste CSV Data</label>
              <textarea
                value={csvText}
                onChange={(e) => setCsvText(e.target.value)}
                rows="6"
                placeholder="Name,Owner,ArbYear&#10;Juan Soto,Team 1,3"
              />
              <button className="btn btn-small btn-secondary" onClick={() => processCSV(csvText)} style={{marginTop: '10px'}}>
                Parse CSV
              </button>
            </div>

            {players.length > 0 && (
              <>
                <div className="success-box">
                  <h4>{players.length} players loaded</h4>
                  {players.filter(p => p.needsDetection).length > 0 && (
                    <button className="btn btn-small btn-blue" onClick={detectAllPlayers} disabled={detecting}>
                      {detecting ? 'Detecting...' : `Auto-Detect ${players.filter(p => p.needsDetection).length} Players`}
                    </button>
                  )}
                </div>

                <div style={{maxHeight: '400px', overflow: 'auto'}}>
                  <table className="data-table">
                    <thead>
                      <tr>
                        <th>Name</th>
                        <th>Owner</th>
                        <th>Arb</th>
                        <th>Team</th>
                        <th>Pos</th>
                        <th>Type</th>
                        <th>Points</th>
                      </tr>
                    </thead>
                    <tbody>
                      {players.map((p, idx) => (
                        <tr key={idx}>
                          <td>{p.name}</td>
                          <td>{p.owner}</td>
                          <td><span className={`arb-badge arb-${p.arbYear}`}>{p.arbYear}</span></td>
                          <td>{p.team || <span className="detecting-badge">?</span>}</td>
                          <td>{p.position || <span className="detecting-badge">?</span>}</td>
                          <td>{p.type || <span className="detecting-badge">?</span>}</td>
                          <td>{p.points || '-'}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </>
            )}

            {error && <div className="error-box">{error}</div>}

            <div className="action-buttons">
              <button className="btn btn-secondary" onClick={() => setStep(2)}>← Back</button>
              <button className="btn btn-success" onClick={saveLeague} disabled={players.length === 0}>
                Create League
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

// League Complete Component
function LeagueComplete({leagueId, leagueName}) {
  const auctionUrl = `${window.location.origin}${window.location.pathname.replace('commissioner.html', 'auction.html')}?league=${leagueId}`;

  const copyToClipboard = (text) => {
    navigator.clipboard.writeText(text);
    alert('Copied to clipboard!');
  };

  return (
    <div className="main-content">
      <div className="success-box">
        <h4>✓ League Created Successfully!</h4>
        <p>Your league "{leagueName}" is ready. Share the link below with your league members.</p>
      </div>

      <div className="card">
        <div className="card-header">Auction Link</div>
        <div className="card-body">
          <div className="auction-link-box">
            <input type="text" value={auctionUrl} readOnly />
            <button className="copy-btn" onClick={() => copyToClipboard(auctionUrl)}>
              Copy Link
            </button>
          </div>
          <div className="info-box" style={{marginTop: '20px'}}>
            <h4>Next Steps</h4>
            <ul>
              <li>Share this link with all league members</li>
              <li>Users will register with username/password and select their team</li>
              <li>Commissioners need the commissioner access code to claim commissioner teams</li>
              <li>Once everyone is registered, you can start the auction</li>
            </ul>
          </div>
          <a href={auctionUrl} target="_blank" className="btn btn-primary" style={{marginTop: '20px'}}>
            Open Auction Page →
          </a>
        </div>
      </div>
    </div>
  );
}

// Main App Component
function App() {
  const [admin, setAdmin] = useState(null);
  const [view, setView] = useState('leagues'); // 'leagues', 'create', 'complete'
  const [currentLeagueId, setCurrentLeagueId] = useState(null);
  const [currentLeagueName, setCurrentLeagueName] = useState('');

  const handleLogin = (adminData) => {
    setAdmin(adminData);
    setView('leagues');
  };

  const handleLogout = () => {
    setAdmin(null);
    setView('leagues');
  };

  const handleCreateNew = () => {
    setCurrentLeagueId(null);
    setView('create');
  };

  const handleSelectLeague = (leagueId) => {
    setCurrentLeagueId(leagueId);
    setView('create');
  };

  const handleLeagueComplete = (leagueId, leagueName) => {
    setCurrentLeagueId(leagueId);
    setCurrentLeagueName(leagueName);
    setView('complete');
  };

  if (!admin) {
    return <LoginScreen onLogin={handleLogin} />;
  }

  return (
    <>
      <div className="header">
        <div className="header-title">Custom Arbitration Auction</div>
        <div className="header-user">
          Admin: {admin.username}
          <button className="logout-btn" onClick={handleLogout}>Logout</button>
        </div>
      </div>

      {view === 'leagues' && (
        <LeagueList admin={admin} onSelectLeague={handleSelectLeague} onCreateNew={handleCreateNew} />
      )}

      {view === 'create' && (
        <LeagueSetup admin={admin} leagueId={currentLeagueId} onComplete={handleLeagueComplete} />
      )}

      {view === 'complete' && (
        <LeagueComplete leagueId={currentLeagueId} leagueName={currentLeagueName} />
      )}
    </>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
